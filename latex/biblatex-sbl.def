\RequireBibliographyStyle{standard}
\RequireBiber[3]

% BibLaTeX version 3.0 or greater required
\newdimen \biblatex@version
\biblatex@version = \abx@version pt
\ifdim \biblatex@version < 3.0pt
  \PackageError{sbl-biblatex}{BibLaTeX v3.0 or greater is required}
\fi

% Require xparse
\RequirePackage{xparse}

% ------------------------------------------------------------------
% VERSION STRINGS
% ------------------------------------------------------------------

\def\sbl@abx@date{2016/01/18}
\def\sbl@abx@version{0.2}
\def\sbl@abx@bbxid{\sbl@abx@date\space v\sbl@abx@version\space biblatex-sbl bibliography style}
\def\sbl@abx@cbxid{\sbl@abx@date\space v\sbl@abx@version\space biblatex-sbl citation style}
\def\sbl@abx@lbxid{\sbl@abx@date\space v\sbl@abx@version\space biblatex-sbl localization}
\def\sbl@abx@defid{\sbl@abx@date\space v\sbl@abx@version\space biblatex-sbl definitions and macros}

\ProvidesFile{biblatex-sbl.def}[\sbl@abx@defid]

% ------------------------------------------------------------------
% CITEPAGES OPTION
% ------------------------------------------------------------------

\DeclareRangeChars{~,;-+/:}

\renewbibmacro*{postnote}{}
\newbibmacro*{pages}{}

\DeclareBibliographyOption{citepages}[permit]{%
  \ifcsdef{cbx@opt@citepages@#1}
    {\csuse{cbx@opt@citepages@#1}}
    {\PackageError{biblatex}
       {Invalid option 'citepages=#1'}
       {Valid values are 'sbl', 'permit', 'omit', 'separate'.}}}

\providebibmacro*{postnote}{}
\providebibmacro*{pages}{}

\def\cbx@opt@citepages@sbl{%
  \renewbibmacro*{pages}{%
    \iffieldundef{pages}
      {}
      {\printfield{pages}%
       \iffieldundef{postnote}
         {}
         {\iffieldpages{postnote}
            {}
            {\setunit{\addspace}%
             \printtext[parens]{\printfield{postnote}}}}}}
  \renewbibmacro*{postnote}{%
    \iffieldundef{postnote}
      {\printfield{pages}}
      {\iffieldpages{postnote}
         {\printfield{postnote}}
         {\iffieldundef{pages}
            {\printfield{postnote}}
            {\printfield{pages}%
             \setunit{\addspace}%
             \printtext[parens]{\printfield{postnote}}}}}}}

\def\cbx@opt@citepages@permit{%
  \renewbibmacro*{pages}{%
    \iffieldundef{pages}
      {}
      {\printfield{pages}%
       \iffieldundef{postnote}
         {}
         {\setunit{\addspace}%
          \printtext[parens]{\printfield{postnote}}}}}
  \renewbibmacro*{postnote}{%
    \iffieldundef{postnote}
      {\printfield{pages}}
      {\iffieldpages{postnote}
         {\printfield{postnote}}
         {\iffieldundef{pages}
            {\newunit
             \printfield{postnote}}
            {\printfield{pages}%
             \setunit*{\addspace}%
             \printtext[parens]{\printfield{postnote}}}}}}}

\def\cbx@opt@citepages@omit{%
  \renewbibmacro*{pages}{%
    \iffieldundef{pages}
      {}
      {\iffieldundef{postnote}
         {\printfield{pages}}
         {\iffieldpages{postnote}
            {\printfield{postnote}}
            {\printfield{pages}%
             \setunit*{\addspace}%
             \printtext[parens]{\printfield{postnote}}}}}}
  \renewbibmacro*{postnote}{%
    \iffieldundef{postnote}
      {\printfield{pages}}
      {\iffieldpages{postnote}
         {\printfield{postnote}}
         {\iffieldundef{pages}
            {\newunit
             \printfield{postnote}}
            {\printfield{pages}%
             \setunit*{\addspace}%
             \printtext[parens]{\printfield{postnote}}}}}}}

\def\cbx@opt@citepages@separate{%
  \renewbibmacro*{pages}{%
    \iffieldundef{pages}
      {}
      {\printfield{pages}%
       \iffieldundef{postnote}
         {}
         {\setunit{\addspace}%
           \printtext[parens]{%
            \iffieldpages{postnote}
              {\bibstring{thiscite}%
               \setunit{\addspace}}
              {}%
            \printfield{postnote}}}}}
  \renewbibmacro*{postnote}{%
    \iffieldundef{postnote}
      {\printfield{pages}}
      {\iffieldpages{postnote}
         {\printfield{postnote}}
         {\iffieldundef{pages}
            {\printfield{postnote}}
            {\printfield{pages}%
             \setunit*{\addspace}%
             \printtext[parens]{%
               \iffieldpages{postnote}
                 {\bibstring{thiscite}%
                  \setunit{\addspace}}
                 {}%
               \printfield{postnote}}}}}}}


% ------------------------------------------------------------------
% COMMENTARY OPTIONS
% ------------------------------------------------------------------

\newtoggle{fullbibrefs}

\DeclareBibliographyOption{fullbibrefs}[false]{%
  \ifstrequal{#1}{true}
    {\toggletrue{fullbibrefs}}
    {\togglefalse{fullbibrefs}}}


% ------------------------------------------------------------------
% ENTRY OPTIONS
% ------------------------------------------------------------------

\newtoggle{blx@citebytitle}
\newtoggle{blx@skipbiblistseries}
\newtoggle{blx@skipbiblistshorthand}
\newtoggle{blx@firstcitenoshorthand}
\newtoggle{blx@shortciteauthor}
\newtoggle{blx@nolongcite}

\DeclareEntryOption{citebytitle}[true]{%
  \settoggle{blx@citebytitle}{#1}}
\DeclareEntryOption{skipbiblistseries}[true]{%
  \settoggle{blx@skipbiblistseries}{#1}}
\DeclareEntryOption{skipbiblistshorthand}[true]{%
  \settoggle{blx@skipbiblistshorthand}{#1}}
\DeclareEntryOption{firstcitenoshorthand}[true]{%
  \settoggle{blx@firstcitenoshorthand}{#1}}
\DeclareEntryOption{shortciteauthor}[true]{%
  \settoggle{blx@shortciteauthor}{#1}}
\DeclareEntryOption{nolongcite}[true]{%
  \settoggle{blx@nolongcite}{#1}}


% ------------------------------------------------------------------
% STYLE OPTIONS
% ------------------------------------------------------------------

\protected\def\blx@imc@printreleasedate{}
\blx@regimcs{\printreleasedate}
\DeclareBibliographyOption{releasedate}{%
  \ifcsdef{mkbibrange#1}
    {\protected\def\blx@imc@printreleasedate{\csuse{mkbibrange#1}{release}}}
    {\blx@err@invopt{releasedate=#1}{}}}

\DeclareBibliographyOption{ibidpage}[true]{%
  \ifstrequal{#1}{true}
    {\ExecuteBibliographyOptions{loccittracker=true}}
    {\ExecuteBibliographyOptions{loccittracker=false}}}

\ExecuteBibliographyOptions{%
  citetracker,
  punctfont,
  usetranslator,
  urldate=comp,
  date=comp,
  releasedate=comp,
  dateabbrev=false,
  autocite=footnote,
  url,
  related,
  isbn=false,
  ibidtracker=true,
  ibidpage=true,
  maxbibnames=99,
  maxcitenames=3,
  citepages=sbl,
  fullbibrefs=false
}

\urlstyle{same}
\def\UrlBreaks{\do\@\do\\\do\/\do\!\do\_\do\|\do\;\do\>\do\]%
 \do\)\do\,\do\?\do\'\do+\do\=\do\#}%
\def\UrlSpecials{\do\.{\penalty\UrlBreakPenalty\mathchar`.}%
  \do\-{\penalty\UrlBreakPenalty\mathchar`-}%
  \do\ {\Url@space}\do\%{\Url@percent}\do\^^M{\Url@space}%
  \Url@force@Tilde}% package option may force faked text-ascii-tilde

\NewBibliographyString{to}
\NewBibliographyString{of}
\NewBibliographyString{withassistance}
\NewBibliographyString{withpreface}
\NewBibliographyString{preface}
\NewBibliographyString{nopages}
\NewBibliographyString{presentedpaper}
\NewBibliographyString{released}

\DeclareLanguageMapping{english}{sbl-american}
\DeclareLanguageMapping{american}{sbl-american}
\DeclareLanguageMapping{british}{sbl-british}
\DeclareLanguageMapping{german}{sbl-german}
\DeclareLanguageMapping{spanish}{sbl-spanish}

\renewcommand*{\subtitlepunct}{\addcolon\space}
\newcommand*{\namedashpunct}{\adddot\space}
\newcommand*{\lexiconfinalnamedelim}{\addcomma\space}
\renewcommand*{\relateddelim}{\addsemicolon\space}

\setcounter{mincompwidth}{10}

\DeclareFieldFormat{doi}{%
  \printtext{doi}\addcolon
  \ifhyperref
    {\href{http://dx.doi.org/#1}{\nolinkurl{#1}}}
    {\nolinkurl{#1}}}
\DeclareFieldFormat{edition}{%
  \ifinteger{#1}
    {\mkbibordedition{#1}~\bibsstring{edition}}
    {\ifcapital{\MakeCapital{#1}}{#1}\isdot}}
\DeclareFieldFormat{eprint:ebook}{#1 \biblstring{edition}}
\DeclareFieldFormat{eprint:literal}{#1}
\DeclareFieldFormat{eprint}{%
  \iffieldundef{eprinttype}
    {eprint}
    {\thefield{eprinttype}}%
  \newunitpunct
  \ifhyperref
    {\url{#1}}
    {\nolinkurl{#1}}%
  \iffieldundef{eprintclass}
    {}
    {\addspace\mkbibparens{\thefield{eprintclass}}}}
\renewcommand*{\volcitedelim}{\addcolon}
\DeclareFieldFormat{volcitevolume}{#1}
\DeclareFieldFormat{volcitepages}{\mkcomprange{#1}}
\DeclareFieldFormat{part}{#1}
\DeclareFieldFormat{pt}{\bibstring{part}~#1}
\DeclareFieldFormat{postnote}{\mkcomprange{#1}}
\DeclareFieldFormat{multipostnote}{#1}
\DeclareFieldFormat{byauthor}{\bibstring{byauthor} #1}
\DeclareFieldFormat{revdtitle}{\biblstring{reviewof} \mkbibemph{#1}}
\DeclareFieldFormat{revdshorttitle}{\biblstring{reviewof} \mkbibemph{#1}}
\DeclareFieldFormat{shorttitle}{\mkbibemph{#1}}
\DeclareFieldFormat{shortbooktitle}{\mkbibemph{#1}}
\DeclareFieldFormat{shortmaintitle}{\mkbibemph{#1}}
\DeclareFieldFormat{shortjournal}{\mkbibemph{#1}}
\DeclareFieldFormat{preface}{#1}
\DeclareFieldFormat{seriesseries}{#1}

\DeclareFieldFormat{pages}{\mkcomprange{#1}}
\DeclareFieldFormat{pagesin}{\mkcomprange[\mkpageprefix]{#1} \usebibmacro{in}}
\DeclareFieldFormat{volume}{#1}
\DeclareFieldFormat{vol}{\bibsstring{volume}~#1}
\DeclareFieldFormat{volumeof}{\bibsstring{volume}~#1 \bibstring{of}}
\DeclareFieldFormat{volumes}{#1\ifnumeral{#1}{~\bibsstring{volumes}}{}}
\DeclareFieldFormat{partof}{\bibstring{part}~#1 \bibstring{of}}
\DeclareFieldFormat{no}{\bibsstring{number}~#1}
\DeclareFieldFormat{url}{\url{#1}}
\DeclareFieldFormat{urldate}{\bibstring{urlseen}\space#1}
\DeclareFieldFormat{releasedate}{\bibstring{released}\space#1}

\DeclareFieldFormat{editortype}{\ifcapital{\MakeCapital{#1}}{#1}}
\DeclareFieldFormat{cptype}{\ifbibstring{#1}{\bibcpstring{#1}}{#1}}
\DeclareFieldFormat{quote}{\mkbibquote{#1}}

\DeclareFieldFormat[incommentary,inreference,inlexicon,online,review,seminarpaper]{title}{\mkbibquote{#1}}
\DeclareFieldFormat[incommentary,inreference,inlexicon,online,review,seminarpaper]{shorttitle}{\mkbibquote{#1}}
\DeclareFieldFormat[inproceedings]{type}{\ifbibstring{#1}{\bibstring{#1}}{#1}}
\DeclareFieldFormat[ancienttext]{title}{%
  \ifboolexpr{
    test {\iffieldequalstr{entrysubtype}{inscription}}
    or
    test {\iffieldequalstr{entrysubtype}{chronicle}}
  }
    {#1}
    {\mkbibquote{#1}}}

\DeclareNameAlias{withpreface}{default}

\DeclareBibliographyAlias{cite:mvbook}{cite:book}
\DeclareBibliographyAlias{cite:mvcollection}{cite:collection}
\DeclareBibliographyAlias{collection}{book}
\DeclareBibliographyAlias{mvcollection}{collection}
\DeclareBibliographyAlias{cite:collection}{cite:book}
\DeclareBibliographyAlias{mvreference}{mvbook}
\DeclareBibliographyAlias{cite:mvreference}{cite:mvbook}
\DeclareBibliographyAlias{reference}{book}
\DeclareBibliographyAlias{cite:reference}{cite:book}
\DeclareBibliographyAlias{lexicon}{reference}
\DeclareBibliographyAlias{cite:lexicon}{cite:reference}
\DeclareBibliographyAlias{mvlexicon}{mvreference}
\DeclareBibliographyAlias{cite:mvlexicon}{cite:mvreference}
\DeclareBibliographyAlias{inbook}{incollection}
\DeclareBibliographyAlias{cite:inbook}{cite:incollection}
\DeclareBibliographyAlias{commentary}{book}
\DeclareBibliographyAlias{mvcommentary}{book}
\DeclareBibliographyAlias{cite:mvcommentary}{cite:mvbook}

\DeclareLabeldate{%
  \field{releasedate}
}

\renewcommand*{\newunitpunct}{\addcomma\space}
\newcommand*{\volpostnotedelim}{\addcolon}

\providecommand*{\mkibid}[1]{#1}

\renewbibmacro*{name:last-first}[4]{%
  \ifuseprefix
    {\usebibmacro{name:delim}{#3#1}%
     \usebibmacro{name:hook}{#3#1}%
     \ifblank{#3}{}{%
       \ifcapital
         {\mkbibnameprefix{\MakeCapital{#3}}\isdot}
         {\mkbibnameprefix{#3}\isdot}%
       \ifpunctmark{'}{}{\bibnamedelimc}}%
     \mkbibnamelast{#1}\isdot
     \ifblank{#2}{}{\revsdnamepunct\bibnamedelimd\mkbibnamefirst{#2}\isdot}%
     \ifblank{#4}{}{\bibnamedelimd\mkbibnameaffix{#4}\isdot}}
    {\usebibmacro{name:delim}{#1}%
     \usebibmacro{name:hook}{#1}%
     \mkbibnamelast{#1}\isdot
     \ifblank{#2#3}{}{\revsdnamepunct}%
     \ifblank{#2}{}{\bibnamedelimd\mkbibnamefirst{#2}\isdot}%
     \ifblank{#3}{}{\bibnamedelimd\mkbibnameprefix{#3}\isdot}%
     \ifblank{#4}{}{\bibnamedelimd\mkbibnameaffix{\addcomma\addspace#4}\isdot}}}


% ------------------------------------------------------------------
% BIBLIOGRAPHY
% ------------------------------------------------------------------

\renewrobustcmd*{\printbibliography}{%
  \begingroup
  \blx@key@bibcheck{bibliography}
  \edef\on@line{\on@line}%
  \@ifnextchar[%]
    {\blx@printbibliography}
    {\blx@printbibliography[]}}
\defbibcheck{bibliography}{%
  \blx@skipentries
  \blx@includeentries
}
\def\blx@skipentries{}
\def\blx@includeentries{}
\def\addskipentry#1{%
  \edef\X{%
    \noexpand\iffieldequalstr{entrykey}{#1}
      {\noexpand\toggletrue{blx@skipentry}}
      {}}%
  \expandafter\g@addto@macro\expandafter\blx@skipentries\expandafter{\X}}
\def\addincludeentry#1{%
  \edef\X{%
    \noexpand\iffieldequalstr{entrykey}{#1}
      {\noexpand\togglefalse{blx@skipentry}}
      {}}%
  \expandafter\g@addto@macro\expandafter\blx@includeentries\expandafter{\X}}

% ------------------------------------------------------------------
% LIST OF ABBREVIATIONS
% ------------------------------------------------------------------

\newlength{\abbrevwidth}

\def\setmaxlength#1#2{%
  \ifdim\dimexpr#2>\dimexpr#1
    \global\setlength{#1}{#2}%
  \fi
}

\defbibenvironment{abbreviations}
  {\list
     {\printfield[shorthandwidth]{shortjournal}%
      \iffieldundef{clone}
        {\printfield[shorthandwidth]{shortseries}}
        {}%
      \ifboolexpr{
        test {\iffieldundef{clone}}
        and
        not test {\iffieldundef{shortseries}}
      }
        {}
        {\iffieldsequal{shorthand}{shorttitle}
           {\printtext{\mkbibemph{\printfield[shorthandwidth]{shorthand}}}}
           {\printfield[shorthandwidth]{shorthand}}}}
     {\setmaxlength{\abbrevwidth}{\shorthandwidth}%
      \setmaxlength{\abbrevwidth}{\shortserieswidth}%
      \setmaxlength{\abbrevwidth}{\shortjournalwidth}%
      \setlength{\labelwidth}{\abbrevwidth}%
      \setlength{\leftmargin}{\labelwidth}%
      \setlength{\labelsep}{\biblabelsep}%
      \addtolength{\leftmargin}{\labelsep}%
      \setlength{\itemsep}{\bibitemsep}%
      \setlength{\parsep}{\bibparsep}%
      \renewcommand*{\makelabel}[1]{##1\hss}}}
  {\endlist}
  {\item}

\DeclareBibliographyDriver{abbreviations}{%
  \citereset
  \def\abx@str{abx@lstr}%
  \renewcommand*{\finentrypunct}{}%
  \iffieldundef{shorthand}{}{%
    \ifboolexpr{
      test {\iffieldundef{clone}}
      and
      not test {\iffieldundef{shortseries}}
    }
      {}
      {\bibhypertarget{\strfield{shorthand}}{}%
       \iffieldsequal{shorthand}{shorttitle}
         {\toggletrue{blx@citebytitle}}
         {}%
         \usebibmacro{bibentrycite}}}%
  \iffieldundef{shortjournal}
    {}
    {\bibhypertarget{\strfield{shortjournal}}{}%
     \printfield{journaltitle}}%
  \iffieldundef{shortseries}
    {}
    {\iffieldundef{clone}
       {\bibhypertarget{\strfield{shortseries}}{}%
        \printfield{series}}
       {}}%
  \usebibmacro{finentry}%
}

\defbibcheck{abbreviations}{%
  \blx@setoptions@entry
  \iftoggle{blx@skipbiblist}{\skipentry}{}%
  \iftoggle{blx@skipbiblistseries}
    {\iffieldundef{shortseries}
       {}
       {\iffieldundef{shorthand}
          {\skipentry}
          {\iffieldundef{clone}{\skipentry}{}}}}
    {}%
  \iftoggle{blx@skipbiblistshorthand}
   {\iffieldundef{shorthand}
      {}
      {\iffieldundef{shortseries}
         {\skipentry}
         {\iffieldundef{clone}{}{\skipentry}}}}
   {}%
  \iftoggle{blx@skipentry}
    {}
    {\iffieldundef{shortseries}
       {}
       {\ifcsdef{\strfield{series}\strfield{clone}}
         {\skipentry}
         {\savefieldcs{series}{\strfield{series}\strfield{clone}}}%   
       }%
     \iffieldundef{shortjournal}
       {}
       {\ifcsdef{\strfield{journaltitle}}
         {\skipentry}
         {\savefieldcs{journaltitle}{\strfield{journaltitle}}}%   
       }%
     \iffieldundef{shorthand}
       {}
       {\ifcsdef{\strfield{shorthand}\strfield{title}}
         {\skipentry}
         {\savefieldcs{shorthand}{\strfield{shorthand}\strfield{title}}}%   
       }%
     \ifboolexpr{
       test {\iffieldundef{shorthand}}
       and
       test {\iffieldundef{shortjournal}}
       and
       test {\iffieldundef{shortseries}}
     }
       {\skipentry}
       {}%
    }%
}

\DeclareSortingScheme{abbreviations}{%
  \sort{%
    \field{shorthand}%
    \field{shortjournal}%
    \field{shortseries}%
  }%
}

% ------------------------------------------------------------------
% SOURCE MAPS
% ------------------------------------------------------------------
%   - cut titles at colons to create short titles
%   - copy titles to shorttitles if they are empty
% ------------------------------------------------------------------

\DeclareSourcemap{
  \maps{
    \map{
      \step[fieldsource=title, match=\regexp{(.*?):}, final]
      \step[fieldset=shorttitle, fieldvalue={$1}]
    }
    \map{
      \pertype{inlexicon}
      \step[fieldset=options, fieldvalue={skipbib=true}]
    }
    \map{
      \step[fieldsource=entrysubtype, match=\regexp{ANRW}, final]
      \step[fieldset=options, fieldvalue={skipbib=false}]
    }
    \map{
      \pertype{ancienttext}
      \pertype{classictext}
      \step[fieldset=options, fieldvalue={skipbib=true}]
    }
    \map[overwrite]{
      \step[fieldsource=shorthand, final]
      \step[fieldsource=shortseries, final]
      \step[fieldsource=shorthand, match=\regexp{(.*)}]
      \step[fieldset=shorthand, null]
      \step[entryclone={shortseries-}]
      \step[fieldset=shorthand, fieldvalue={$1}]
      \step[fieldsource=entrykey, match=\regexp{(.*)}]
      \step[fieldset=clone, fieldvalue={shortseries-$1}]
    }
  }
}

% ------------------------------------------------------------------
% DATA INHERITANCE
% ------------------------------------------------------------------

\DeclareDataInheritance{mvbook,mvcollection,mvreference}
    {book,inbook,collection,incollection,reference,inreference}{%
  \inherit{editor}{maineditor}
  \inherit{translator}{maintranslator}
  \inherit{shorttitle}{shortmaintitle}
  \noinherit{endyear}
}

\DeclareDataInheritance{book,collection,reference}
    {bookinbook,inbook,incollection,inreference}{%
  \inherit{editor}{bookeditor}
  \inherit{translator}{booktranslator}
  \inherit{shorttitle}{shortbooktitle}
}

\DeclareDataInheritance{mvlexicon,mvcommentary}
    {lexicon,inlexicon,commentary,incommentary}{%
  \inherit{editor}{maineditor}
  \inherit{translator}{maintranslator}
  \inherit{title}{maintitle}
  \inherit{subtitle}{mainsubtitle}
  \inherit{titleaddon}{maintitleaddon}
  \inherit{shorttitle}{shortmaintitle}
  \noinherit{sorttitle}
  \noinherit{indextitle}
  \noinherit{indexsorttitle}
  \noinherit{endyear}
}

\DeclareDataInheritance{lexicon,commentary}{inlexicon,incommentary}{%
  \inherit{editor}{bookeditor}
  \inherit{translator}{booktranslator}
  \inherit{title}{booktitle}
  \inherit{subtitle}{booksubtitle}
  \inherit{titleaddon}{booktitleaddon}
  \inherit{shorttitle}{shortbooktitle}
  \noinherit{sorttitle}
  \noinherit{indextitle}
  \noinherit{indexsorttitle}
}

\DeclareDataInheritance{*}{*}{%
  \noinherit{sblxref}
}

% ------------------------------------------------------------------
% LANGUAGE
% ------------------------------------------------------------------
%   - use literals for origlanguage if no translation found
% ------------------------------------------------------------------

\renewcommand*{\lbx@lfromlang}{%
  \iffieldundef{origlanguage}
    {\unspace}
    {\ifbibstring{from\thefield{origlanguage}}
      {\biblstring{from\thefield{origlanguage}}}
      {from \printfield{origlanguage}}}}

\renewcommand*{\lbx@sfromlang}{%
  \iffieldundef{origlanguage}
    {\unspace}
    {\ifbibstring{from\thefield{origlanguage}}
       {\bibsstring{from\thefield{origlanguage}}}
       {from \printfield{origlanguage}}}}

% ------------------------------------------------------------------
% JOINING WORD MACROS
% ------------------------------------------------------------------

\newbibmacro*{in}{%
  \printtext{\bibstring{in}}%
  \setunit{\addspace}}

\newbibmacro*{to}{%
  \printtext{\bibstring{to}}%
  \setunit{\addspace}}

\newbibmacro*{of}{%
  \printtext{\bibstring{of}}%
  \setunit{\addspace}}

% ------------------------------------------------------------------
% TITLE MACROS
% ------------------------------------------------------------------

\newbibmacro*{shorttitle}{%
  \iftoggle{blx@shortciteauthor}
    {}
    {\iffieldundef{shorttitle}
       {\iffieldundef{title}
          {}
          {\printtext[title]{\printfield[titlecase]{title}}}}
       {\printtext[title]{\printfield[titlecase]{shorttitle}}}%
     \newunit}}

\newbibmacro*{shortbooktitle}{%
  \iffieldundef{shortbooktitle}
    {\iffieldundef{booktitle}
       {}
       {\printtext[booktitle]{\printfield[titlecase]{booktitle}}}}
    {\printtext[booktitle]{\printfield[titlecase]{shortbooktitle}}}%
  \newunit}

\newbibmacro*{shortmaintitle}{%
  \iffieldundef{shortmaintitle}
    {\iffieldundef{maintitle}
       {}
       {\printtext[maintitle]{\printfield[titlecase]{maintitle}}}}
    {\printtext[maintitle]{\printfield[titlecase]{shortmaintitle}}}%
  \newunit}

\renewbibmacro*{title}{%
  \ifciteseen
    {\ifboolexpr{
       test {\iffieldundef{author}}
       and
       not test {\iffieldundef{editor}}
     }
       {}
       {\usebibmacro{shorttitle}}}
    {\ifboolexpr{
       test {\iffieldundef{title}}
       and
       test {\iffieldundef{subtitle}}
     }
       {}
       {\printtext[title]{%
          \printfield[titlecase]{title}%
          \setunit{\subtitlepunct}%
          \printfield[titlecase]{subtitle}}%
        \newunit}%
     \printfield{titleaddon}}}

\renewbibmacro*{booktitle}{%
  \ifciteseen
    {\usebibmacro{shortbooktitle}}
    {\ifboolexpr{
       test {\iffieldundef{booktitle}}
       and
       test {\iffieldundef{booksubtitle}}
     }
       {}
       {\printtext[booktitle]{%
          \printfield[titlecase]{booktitle}%
          \setunit{\subtitlepunct}%
          \printfield[titlecase]{booksubtitle}}%
        \newunit}%
     \printfield{booktitleaddon}}}

\renewbibmacro*{maintitle}{%
  \ifciteseen
    {\usebibmacro{shortmaintitle}}
    {\ifboolexpr{
       test {\iffieldundef{maintitle}}
       and
       test {\iffieldundef{mainsubtitle}}
     }
       {}
       {\printtext[maintitle]{%
          \printfield[titlecase]{maintitle}%
          \setunit{\subtitlepunct}%
          \printfield[titlecase]{mainsubtitle}}%
        \newunit}%
     \printfield{maintitleaddon}}}

\newbibmacro*{booktitle+maintitle}{%
  \iffieldundef{booktitle}
    {\iffieldundef{maintitle}
      {}
      {\usebibmacro{maintitle}%
       \clearfield{maintitle}%
       \clearfield{mainsubtitle}%
       \clearfield{maintitleaddon}
       \newunit}}
    {\usebibmacro{booktitle}%
     \clearfield{booktitle}%
     \clearfield{booksubtitle}%
     \clearfield{bootitleaddon}%
     \newunit}}

\newbibmacro*{shortbooktitle+shortmaintitle}{%
  \iffieldundef{booktitle}
    {\iffieldundef{maintitle}
      {}
      {\usebibmacro{shortmaintitle}
       \newunit}}
    {\usebibmacro{shortbooktitle}%
     \newunit}}

\newbibmacro*{revdshorttitle}{%
  \iffieldundef{revdshorttitle}
     {\iffieldundef{revdtitle}
        {}
        {\printtext[revdtitle]{\printfield[titlecase]{revdtitle}}}}
     {\printtext[revdtitle]{\printfield[titlecase]{revdshorttitle}}}%
   \newunit}

\newbibmacro*{revdtitle}{%
  \ifciteseen
    {\usebibmacro{revdshorttitle}}
    {\ifboolexpr{
       test {\iffieldundef{revdtitle}}
       and
       test {\iffieldundef{revdsubtitle}}
     }
       {}
       {\printtext[revdtitle]{%
          \printfield[titlecase]{revdtitle}%
          \setunit{\subtitlepunct}%
          \printfield[titlecase]{revdsubtitle}}%
        \newunit}%
     \printfield{revdtitleaddon}}}

\newbibmacro*{sblxrefshortbooktitle+sblxrefshortmaintitle}{%
  \iffieldundef{sblxref}
    {\usebibmacro{shortbooktitle+shortmaintitle}}
    {\entrydata{\thefield{sblxref}}{%
       \iffieldundef{shorttitle}
         {\usebibmacro{shorttitle}}
         {\printtext[shorttitle]{%
            \bibhyperlink{\strfield{shorthand}}{\thefield{shorttitle}}}}}}}

\newbibmacro*{sblxrefshortmaintitle}{%
  \iffieldundef{sblxref}
    {\usebibmacro{shortmaintitle}}
    {\entrydata{\thefield{sblxref}}{%
       \iffieldundef{shorttitle}
         {\usebibmacro{shorttitle}}
         {\printtext[shorttitle]{%
            \bibhyperlink{\strfield{shorthand}}{\thefield{shorttitle}}}}}}}

\newbibmacro*{shortjournal}{%
  \iffieldundef{shortjournal}
    {\printfield{journaltitle}}
    {\printtext[shortjournal]{%
       \bibhyperlink{\strfield{shortjournal}}{\thefield{shortjournal}}}}}

\newbibmacro*{shortjournal+issuetitle}{%
  \usebibmacro{shortjournal}%
  \iffieldundef{series}
    {}
    {\newunit
     \printfield{series}}%
  \usebibmacro{volume+number+eid}%
  \usebibmacro{issue+date}}

\renewbibmacro*{issue+date}{%
  \ifboolexpr{
    test {\iffieldundef{year}}
    and
    test {\iffieldundef{issue}}
    and
    test {\iffieldundef{date}}
    and
    test {\iffieldundef{month}}
    and
    test {\iffieldundef{day}}
  }
    {}
    {\iffieldundef{volume}
      {\setunit{\addcomma\space}%
        \iffieldundef{issue}
          {\usebibmacro{date}}
          {\printfield{issue}%
           \setunit*{\addspace}%
           \usebibmacro{date}}
        \setunit{\addcomma\space}}
       {\setunit{\addspace}%
        \printtext[parens]{%
          \iffieldundef{issue}
            {\usebibmacro{date}}
            {\printfield{issue}%
             \setunit*{\addspace}%
             \usebibmacro{date}}}%
        \setunit{\addcolon\space}}}}

\renewbibmacro*{volume+number+eid}{%
  \setunit*{\addspace}%
  \printfield{volume}%
  \setunit*{\addperiod}%
  \printfield{number}%
  \setunit*{\addcomma\space}%
  \printfield{eid}}

\newbibmacro*{volume+part}{%
  \iffieldundef{volume}
    {}
    {\iffieldundef{part}
       {\usebibmacro{volumeof}}
       {\printfield[vol]{volume}%
        \setunit{\addcomma\addspace}%
        \iffieldundef{maintitle}
          {\printfield[pt]{part}%
           \newunit}
          {\printfield[partof]{part}
           \setunit{\addspace}}}}}

% ------------------------------------------------------------------
% NAME MACROS
% ------------------------------------------------------------------

\renewbibmacro*{bytypestrg}[2]{%
  \iffieldundef{#1type}
    {\bibstring{by#2}}
    {\ifbibxstring{by\thefield{#1type}}
       {\bibstring{by\thefield{#1type}}}
       {\ifbibxstring{\thefield{#1type}}
          {\bibstring{\thefield{#1type}}}
          {\printtext[editortype]{\thefield{#1type}}}}}}

\renewbibmacro*{author}{%
  \ifboolexpr{
    test \ifuseauthor
    and
    not test {\ifnameundef{author}}
  }
    {\ifciteseen{%
       \printnames[labelname]{author}%
     }{%
       \iffieldundef{authortype}
         {\renewcommand*{\namedashpunct}{\adddot\space}}
         {\renewcommand*{\namedashpunct}{\addcomma\space}}%
       \usebibmacro{dashcheck}
         {\bibnamedash}
         {\printnames{author}%
          \usebibmacro{savehash}}%
       \iffieldundef{authortype}
         {}
         {\setunit{\addcomma\space}%
          \usebibmacro{authorstrg}}}}
    {\global\undef\bbx@lasthash}}

\renewbibmacro*{bybookauthor}{%
  \ifboolexpr{
    test \ifuseauthor
    and
    not test {\ifnameundef{bookauthor}}
  }
    {\usebibmacro{bytypestrg}{author}{author}%
     \setunit{\addspace}%
     \printnames[byauthor]{bookauthor}}
    {}
}
     
\renewbibmacro*{editor+others}{%
  \ifboolexpr{
    test \ifuseeditor
    and
    not test {\ifnameundef{editor}}
  }
    {\ifciteseen{%
       \printnames[labelname]{editor}%
     }{%
       \renewcommand*{\namedashpunct}{\addcomma\space}%
       \usebibmacro{dashcheck}
         {\bibnamedash}
         {\printnames{editor}%
          \usebibmacro{savehash}}%
       \setunit{\addcomma\space}%
       \usebibmacro{editor+othersstrg}%
     }%
     \clearname{editor}}
    {}}

\renewbibmacro*{translator+others}{%
  \ifboolexpr{
    test \ifusetranslator
    and
    not test {\ifnameundef{translator}}
  }
    {\ifciteseen{%
       \printnames[labelname]{translator}%
       \setunit{\addcomma\space}%
       \usebibmacro{translatorstrg}%
     }{%
       \renewcommand{\namedashpunct}{\addcomma\space}%
       \usebibmacro{dashcheck}
         {\bibnamedash}
         {\printnames{translator}%
          \usebibmacro{savehash}}%
       \setunit{\addcomma\space}%
       \usebibmacro{translator+othersstrg}%
     }%
     \clearname{translator}}
    {}}

\renewbibmacro*{byeditor}{%
  \ifnameundef{editor}
    {}
    {\usebibmacro{bytypestrg}{editor}{editor}%
     \setunit{\addspace}%
     \printnames[byeditor]{editor}%
     \setunit{\addcomma\space}}%
  \usebibmacro{byeditorx}}
  
\renewbibmacro*{byeditor+others}{%
  \ifnameundef{editor}
    {}
    {\usebibmacro{byeditor+othersstrg}%
     \setunit{\addspace}%
     \printnames[byeditor]{editor}%
     \clearname{editor}%
     \setunit{\addcomma\space}}%
  \usebibmacro{byeditorx}%
  \usebibmacro{bytranslator+others}}

\newbibmacro*{bybookeditor+others}{%
  \ifnameundef{editor}
    {}
    {\usebibmacro{byeditor+othersstrg}%
     \setunit{\addspace}%
     \printnames[byeditor]{editor}%
     \clearname{editor}%
     \newunit}%
  \ifnameundef{bookeditor}
    {}
    {\usebibmacro{byeditor+othersstrg}%
     \setunit{\addspace}%
     \printnames[byeditor]{bookeditor}%
     \clearname{bookeditor}%
     \newunit}%
  \usebibmacro{byeditorx}%
  \usebibmacro{bybooktranslator+others}}

\newbibmacro*{bymaineditor+others}{%
  \ifnameundef{editor}
    {}
    {\usebibmacro{byeditor+othersstrg}%
     \setunit{\addspace}%
     \printnames[byeditor]{editor}%
     \clearname{editor}%
     \newunit}%
  \ifnameundef{maineditor}
    {}
    {\usebibmacro{byeditor+othersstrg}%
     \setunit{\addspace}%
     \printnames[byeditor]{maineditor}%
     \clearname{maineditor}%
     \newunit}%
  \usebibmacro{byeditorx}%
  \usebibmacro{bymaintranslator+others}}

\newbibmacro*{bybooktranslator+others}{%
  \ifnameundef{translator}
    {}
    {\usebibmacro{bytranslator+othersstrg}%
     \setunit{\addspace}%
     \printnames[bytranslator]{translator}%
     \clearname{translator}%
     \newunit}%
  \ifnameundef{booktranslator}
    {}
    {\usebibmacro{bytranslator+othersstrg}%
     \setunit{\addspace}%
     \printnames[bytranslator]{booktranslator}%
     \clearname{booktranslator}%
     \newunit}%
  \usebibmacro{withothers}}

\newbibmacro*{bymaintranslator+others}{%
  \ifnameundef{translator}
    {}
    {\usebibmacro{bytranslator+othersstrg}%
     \setunit{\addspace}%
     \printnames[bytranslator]{translator}%
     \clearname{translator}%
     \newunit}%
  \ifnameundef{maintranslator}
    {}
    {\usebibmacro{bytranslator+othersstrg}%
     \setunit{\addspace}%
     \printnames[bytranslator]{maintranslator}%
     \clearname{maintranslator}%
     \newunit}%
  \usebibmacro{withothers}}

\newbibmacro*{revdauthor}{%
  \ifboolexpr{
    test \ifuseauthor
    and
    not test {\ifnameundef{revdauthor}}
  }
    {\bibstring{byauthor}%
     \setunit{\addspace}%
     \ifciteseen{%
       \printnames[labelname]{revdauthor}%
     }{%
       \printnames{revdauthor}%
       \iffieldundef{authortype}
         {}
         {\setunit{\addcomma\space}%
          \usebibmacro{authorstrg}}}}
    {}}

\newbibmacro*{revdeditor}{%
  \ifboolexpr{
    test \ifuseeditor
    and
    not test {\ifnameundef{revdeditor}}
  }
    {\bibsstring{byeditor}%
     \setunit{\addspace}%
     \ifciteseen{%
       \printnames[labelname]{revdeditor}%
     }{%
       \printnames{revdeditor}%
     }%
     \clearname{revdeditor}}
    {}}

\newbibmacro*{revdauthor/revdeditor}{%
  \ifboolexpr{
    test \ifuseauthor
    and
    not test {\ifnameundef{revdauthor}}
  }
    {\usebibmacro{revdauthor}}
    {\usebibmacro{revdeditor}}}


\newbibmacro*{revdauthor/revdeditor+revdtitle}{%
  \biblstring{reviewof}%
  \setunit{\addspace}%
  \usebibmacro{revdauthor/revdeditor}%
  \ifciteseen
    {}
    {\setunit{\addcomma\space}%
     \usebibmacro{revdtitle}}}

\newbibmacro*{withpreface}{%
  \ifnameundef{preface}
    {}
    {\setunit{\addcomma\addspace}%
     \bibstring{withpreface}%
     \setunit{\addspace}%
  \printnames[withpreface]{preface}}}

\renewbibmacro*{withothers}{%
  \usebibmacro{withcommentator}%
  \clearname{commentator}%
  \newunit
  \usebibmacro{withannotator}%
  \clearname{annotator}%
  \newunit
  \usebibmacro{withintroduction}%
  \clearname{introduction}%
  \newunit
  \usebibmacro{withforeword}%
  \clearname{foreword}%
  \newunit
  \usebibmacro{withpreface}%
  \clearname{preface}%
  \newunit
  \usebibmacro{withafterword}%
  \clearname{afterword}}

\newbibmacro*{shortseries+number}{%
  \iffieldundef{shortseries}
    {\printfield{series}}
    {\printtext[shortseries]{%
       \bibhyperlink{\strfield{shortseries}}{\thefield{shortseries}}}}%
  \setunit{\addspace}%
  \iffieldundef{seriesseries}
    {}
    {\printfield{seriesseries}%
     \printtext{/}}%
  \printfield{number}%
  \newunit}

\newbibmacro*{parens+publisher+location+date}{%
  \setunit{\space}
  \printtext[parens]{%
    \usebibmacro{publisher+location+date}%
    \iffieldequalstr{relatedtype}{reprint}
      {\setunit{\addsemicolon\space}%
       \usebibmacro{related:init}%
       \usebibmacro{related}%
       \global\toggletrue{relatedseen}}
      {}}}

\renewbibmacro*{publisher+location+date}{%
  \usebibmacro{reprint}%
  \printlist{location}%
  \iflistundef{publisher}
    {\setunit*{\addcomma\space}}
    {\setunit*{\addcolon\space}}%
  \printlist{publisher}%
  \setunit*{\addcomma\space}%
  \usebibmacro{date}%
  \newunit}

\newbibmacro*{origpublisher+location+date}{%
  \printlist{origlocation}%
  \iflistundef{origpublisher}
    {\setunit*{\addcomma\space}}
    {\setunit*{\addcolon\space}}%
  \printlist{origpublisher}%
  \setunit*{\addcomma\space}%
  \usebibmacro{origdate}%
  \newunit}

\newbibmacro*{volume}{%
  \iffieldundef{volume}
    {}
    {\setunit{\addspace}%
     \global\booltrue{usevolpostnotedelim}%
     \printfield{volume}%
     \newunit}}

\newbibmacro*{volumeof}{%
  \iffieldundef{volume}
    {}
    {\iffieldundef{part}
      {\iffieldundef{maintitle}
        {\ifbibliography
           {\printfield[vol]{volume}%
            \newunit}
           {}}
        {\printfield[volumeof]{volume}%
         \setunit{\addspace}}}
      {}}}%

\newbibmacro*{volume+pages}{%
  \iffieldundef{volume}
    {}
    {\setunit{\addspace}%
     \printfield{volume}%
     \setunit{\volpostnotedelim}}
  \usebibmacro{pages}}

\newbibmacro*{volume+part+pages}{%
  \ifboolexpr{
    test {\iffieldundef{volume}}
    or
    test {\iffieldundef{part}}
  }
    {}
    {\printfield{volume}%
     \setunit{\addperiod}%
     \printfield{part}%
     \setunit{\volpostnotedelim}}
  \usebibmacro{pages}}

\newbibmacro*{volume+part+nomaintitle}{%
  \iffieldundef{volume}
    {}
    {\iffieldundef{maintitle}
       {\printfield{volume}%
        \setunit{\addperiod}%
        \printfield{part}%
        \global\booltrue{usevolpostnotedelim}}
       {}}}

\renewbibmacro*{url+urldate}{%
  \iffieldundef{urlyear}
    {}
    {\printurldate}%
  \newunit
  \printfield{url}}

\newbibmacro*{ebookedition}{%
  \iffieldundef{ebookedition}
    {}
    {\printfield{ebookedition}}}

\newbibmacro*{reprint}{%
  \ifboolexpr{
    not test {\iffieldundef{origpublisher}}
    or
    not test {\iffieldundef{origlocation}}
    or
    not test {\iffieldundef{origyear}}
  }
    {\usebibmacro{origpublisher+location+date}%
     \ifbibliography
       {\setunit{\addperiod\space}}
       {\setunit{\addsemicolon\space}}%
     \bibstring{reprint}%
     \setunit{\addcomma\addspace}}
    {}}

\renewbibmacro*{date}{%
  \printdate
  \setunit{\addcomma\addspace}%
  \printfield{pubstate}}

\newbibmacro*{origdate}{\printorigdate}

\newbibmacro*{releasedate}{\printreleasedate}

\newbibmacro*{usesblxref}{%
  \iffieldundef{sblxref}
    {}
    {\nocite{\thefield{sblxref}}}}


% ------------------------------------------------------------------
% RELATED MACROS
% ------------------------------------------------------------------

\renewbibmacro*{related:default}[1]{%
  \entrydata*{#1}{%
    \usedriver
      {\renewbibmacro*{author/editor+others/translator+others}{}%
       \renewbibmacro*{related:init}{}}
      {cite:\thefield{entrytype}}
    \setunit{\relateddelim}%
    \usebibmacro{related}}}

\newbibmacro*{related:reprint}[1]{%
  \entrydata*{#1}{%
    \usedriver
      {\renewbibmacro*{related:init}{}%
       \renewbibmacro*{parens+publisher+location+date}{%
         \newunit
         \usebibmacro{publisher+location+date}}}
      {cite:\thefield{entrytype}}}}


% ------------------------------------------------------------------
% ANCIENT AND CLASSIC TEXT MACROS
% ------------------------------------------------------------------

\newbool{usingshortcite}

\newbibmacro*{ancienttextcite}{%
  \iftoggle{blx@nolongcite}
    {\let\ifciteseen\@firstoftwo}
    {}%
  \global\boolfalse{usingshortcite}%
  \ifboolexpr{%
    test {\iftoggle{blx@shortciteauthor}}
    and
    test {\ifciteseen}
  }
    {\global\booltrue{usingshortcite}}
    {}%
  \addincludeentry{\thefield{entrykey}}%
  \iffieldundef{clone}
    {}
    {\nocite{\thefield{clone}}%
     \addskipentry{\thefield{clone}}}%
  \booltrue{suppresspostnote}%
  \boolfalse{usevolpostnotedelim}%
  \global\togglefalse{usingibid}%
  \printtext{%
    \iffieldundef{shorthand}
      {\usedriver{}{cite:\thefield{entrytype}}}
      {\ifboolexpr{
         not test {\ifciteseen}
         and
         test {\iftoggle{blx@firstcitenoshorthand}}
       }
         {\usedriver{}{cite:\thefield{entrytype}}}
         {\global\booltrue{usingshortcite}%
          \usebibmacro{cite:shorthand}%
          \setunit{\addspace}%
          \usebibmacro{ancienttext+volume+nomaintitle}}}}}

\newbibmacro*{ancienttext+volume+nomaintitle}{%
  \iffieldundef{maintitle}
    {\ifbool{usingshortcite}
       {\usebibmacro{setpostnotedelim}}{}%
     \usebibmacro{volume}%
     \setunit{\addperiod}%
     \printfield{part}%
     \ifbool{usevolpostnotedelim}
       {\setunit{\volpostnotedelim}}
       {\setunit{\postnotedelim}}%
     \ifciteseen
       {}
       {\usebibmacro{pages}}}
    {}}

\newbibmacro*{ancienttext+volume+pages}{%
  \ifbool{usingshortcite}
    {\usebibmacro{setpostnotedelim}}{}%
  \usebibmacro{volume}%
  \setunit{\addperiod}%
  \printfield{part}%
  \ifbool{usevolpostnotedelim}
    {\setunit{\volpostnotedelim}}
    {\setunit{\postnotedelim}}%
  \ifciteseen
    {\usebibmacro{postnote}}
    {\iffieldundef{pages}
       {\usebibmacro{postnote}}
       {\usebibmacro{pages}}}}

\newbibmacro*{classic:translator+series}{%
  \ifboolexpr{
    not test {\ifnameundef{translator}}
    or
    not test {\iffieldundef{series}}
  }
    {\setunit{\addspace}%
     \printtext[parens]{%
       \printnames[labelname]{translator}%
       \newunit
       \usebibmacro{shortseries+number}}}
    {}}


% ------------------------------------------------------------------
% ALTERNATE POSTNOTE MACROS
% ------------------------------------------------------------------

\ExplSyntaxOn
\cs_generate_variant:Nn \__xparse_split_argument:nnn { nno }
\cs_new_eq:NN \eSplitArgument  \__xparse_split_argument:nno
\DeclareDocumentCommand \splitpostnote
{ > { \eSplitArgument { 1 } { | } } m }
{ \savepostnotes #1 }
\DeclareDocumentCommand{\savepostnotes}{mm}{%
  \IfNoValueTF{#2}
    {\gdef\postnotelast{#1}}
    {\tl_if_empty:nF {#1}
       {\gdef\postnotefirst{#1}}%
     \tl_if_empty:nF {#2}
       {\gdef\postnotelast{#2}}}}
\ExplSyntaxOff

\def\setuppostnotes{%
  \global\undef\postnotefirst
  \global\undef\postnotelast
  \splitpostnote{\abx@field@postnote}}

\renewbibmacro*{prenote}{%
  \iffieldundef{postnote}
    {}
    {\setuppostnotes
     \restorefield{postnote}{\postnotelast}%
     \restorefield{altpostnote}{\postnotefirst}}%
  \iffieldundef{prenote}
    {}
    {\printfield{prenote}%
     \setunit{\prenotedelim}}}

\DeclareFieldFormat{altpostnote}{\mkcomprange{#1}}

% ------------------------------------------------------------------
% BIBLIOGRAPHY REPEATED AUTHOR MACROS
% ------------------------------------------------------------------

\renewcommand*{\bibnamedash}{%
  \leavevmode\raise 0.6ex\hbox to 3em{\hrulefill}\namedashpunct}

\newbibmacro*{bbx:dashcheck}[2]{%
  \ifboolexpr{
    test {\iffieldequals{fullhash}{\bbx@lasthash}}
    and
    not test \iffirstonpage
  }
    {#1}
    {#2}}

\newbibmacro*{cbx:dashcheck}[2]{#2}

\newbibmacro*{dashcheck}[2]{%
  \usebibmacro{cbx:dashcheck}{#1}{#2}}

\newbibmacro*{savehash}{}

