%Copyright 2015-2016 David Purton
%
%This work may be distributed and/or modified under the
%conditions of the LaTeX Project Public License, either version 1.3
%of this license or (at your option) any later version.
%The latest version of this license is in
%    http://www.latex-project.org/lppl.txt
%and version 1.3 or later is part of all distributions of LaTeX
%version 2005/12/01 or later.
%
%This work has the LPPL maintenance status `maintained'.
%
%The Current Maintainer of this work is David Purton.
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sbl-paper}
  [2016/04/23 Society of Bibilical Literature Paper Style]


% Load required packages

\RequirePackage{fontspec}
\RequirePackage{polyglossia}
\RequirePackage{csquotes}
\RequirePackage[headheight=14.5pt,margin=1in]{geometry}
\RequirePackage{setspace}
\RequirePackage{titlesec}
\RequirePackage{titletoc}
\RequirePackage{quoting}
\RequirePackage{fancyhdr}
\RequirePackage[bottom]{footmisc}
\RequirePackage[style=sbl,backend=biber]{biblatex}


% Set up Languages

\setdefaultlanguage[variant=american]{english}
\setotherlanguage[variant=ancient]{greek}
\setotherlanguage{hebrew}

\renewenvironment{hebrew}[1][]{%
  \par
  \raggedleft
  \begin{otherlanguage}[#1]{hebrew}}%
  {\end{otherlanguage}\par}

% Set up fonts

\newfontfamily\greekfont
  [Script=Greek,Contextuals=Alternate,Ligatures=Required]
  {SBL BibLit}
\newfontfamily\hebrewfont
  [Script=Hebrew,Contextuals=Alternate,Ligatures=Required,Scale=1.2]
  {SBL BibLit}


% Set up document spacing

\doublespacing
\raggedright
\raggedbottom
\setlength{\parindent}{0.5in}
\frenchspacing


% Set up headers and footers

\pagestyle{fancy}
\fancyhf{}
\fancyhead[R]{\thepage}
\renewcommand{\headrulewidth}{0pt}

\renewcommand\footnoterule{\kern-3pt \hrule width 2in \kern 2.6pt\vskip -8pt}
\renewcommand\footnotelayout{\raggedright}
\setlength{\footnotemargin}{0.5in}
\setlength{\footnotesep}{18pt}


% set up quotations

\quotingsetup{leftmargin=0.5in,rightmargin=0in,vskip=0pt}
\renewcommand*{\quotingfont}{\singlespacing\vspace*{-5pt}}


% Set up Bibliography

\renewcommand*{\bibsetup}{\vspace*{7pt}}

\setlength{\bibitemsep}{14.5pt}

\DefineBibliographyStrings{english}{%
  shorthands = {List of Abbreviations}
}

\ifcase\abx@classtype\relax % article
  \defbibheading{bibliography}[\bibname]{%
    \clearpage
    \thispagestyle{plain}%
    \firstsection*{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{biblist}[\biblistname]{%
    \clearpage
    \thispagestyle{plain}%
    \section*{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{bibintoc}[\bibname]{%
    \clearpage
    \thispagestyle{plain}%
    \firstsection*{#1}%
    \addcontentsline{toc}{section}{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{biblistintoc}[\biblistname]{%
    \clearpage
    \thispagestyle{plain}%
    \section*{#1}%
    \addcontentsline{toc}{section}{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}

\or % book/report
  \defbibheading{bibliography}[\bibname]{%
    \clearpage
    \thispagestyle{plain}%
    \chapter*{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{biblist}[\biblistname]{%
    \clearpage
    \thispagestyle{plain}%
    \section*{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{bibintoc}[\bibname]{%
    \clearpage
    \thispagestyle{plain}%
    \chapter*{#1}%
    \addcontentsline{toc}{chapter}{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}
  \defbibheading{biblistintoc}[\biblistname]{%
    \clearpage
    \thispagestyle{plain}%
    \section*{#1}%
    \addcontentsline{toc}{chapter}{#1}%
    \markboth{\MakeUppercase{#1}}{\MakeUppercase{#1}}}

\fi


% Set up section headings and table of contents

\setcounter{secnumdepth}{0}
\titleformat
  {\chapter}
  [block]
  {\singlespacing\centering}
  {\MakeUppercase{\chaptertitlename} \thechapter:}
  {.5em}
  {\MakeUppercase}
\titleformat
  {\section}
  [block]
  {\singlespacing\centering}
  {\thesection}
  {.5em}
  {\MakeUppercase}
\titleformat
  {\subsection}
  [block]
  {\singlespacing\centering\bfseries}
  {\thesubsection}
  {.5em}
  {}
\titleformat
  {\subsubsection}
  [block]
  {\singlespacing\centering}
  {\thesubsubsection}
  {.5em}
  {}
\titleformat
  {\paragraph}
  [hang]
  {\singlespacing\raggedright\bfseries\itshape}
  {\theparagraph}
  {.5em}
  {}
\titleformat
  {\subparagraph}
  [hang]
  {\singlespacing\raggedright}
  {\thesubparagraph}
  {.5em}
  {}
\titlespacing*{\chapter}{0pt}{38pt}{29pt}
\titlespacing*{\section}{0pt}{38pt}{29pt}
\titlespacing*{\subsection}{0pt}{38pt}{0pt}
\titlespacing*{\subsubsection}{0pt}{38pt}{0pt}
\titlespacing*{\paragraph}{0pt}{38pt}{0pt}
\titlespacing*{\subparagraph}{0pt}{38pt}{0pt}
\assignpagestyle{\chapter}{plain}
\def\firstsection{%
  \clearpage
  \vspace*{0pt}
  \thispagestyle{plain}
  \section}
\setcounter{tocdepth}{3}
\renewcommand\tableofcontents{%
    \if@twocolumn
      \@restonecoltrue\onecolumn
    \else
      \@restonecolfalse
    \fi
    \section*{\contentsname
        \@mkboth{%
           \MakeUppercase\contentsname}{\MakeUppercase\contentsname}}%
    \@starttoc{toc}%
    \if@restonecol\twocolumn\fi
    \thispagestyle{plain}
    }
\titlecontents{chapter}
  [0pt]
  {\singlespacing}
  {\MakeUppercase{\chaptertitlename~\thecontentslabel}: \MakeUppercase}
  {\MakeUppercase}
  {\hspace{.5em}\titlerule*[.5pc]{.}\contentspage}
\titlecontents{section}
  [0pt]
  {\singlespacing}
  {\MakeUppercase{\chaptertitlename~\thecontentslabel}: \MakeUppercase}
  {\MakeUppercase}
  {\hspace{.5em}\titlerule*[.5pc]{.}\contentspage}
\titlecontents{subsection}
  [1em]
  {\singlespacing}
  {\thecontentslabel~}
  {}
  {\hfill\contentspage}
\titlecontents{subsubsection}
  [1em]
  {\singlespacing}
  {\thecontentslabel~}
  {}
  {\hfill\contentspage}

\renewcommand\appendix{\par
  \ifcase\abx@classtype\relax % article
    \setcounter{section}{0}%
    \setcounter{secnumdepth}{1}
    \gdef\@chapapp{\appendixname}%
    \titleformat
      {\section}
      [block]
      {\singlespacing\centering}
      {\MakeUppercase{\chaptertitlename} \thesection:}
      {.5em}
      {\MakeUppercase}
    \titlecontents{section}
      [0pt]
      {\singlespacing}
      {\MakeUppercase{\appendixname~\thecontentslabel}: \MakeUppercase}
      {\MakeUppercase}
      {\hspace{.5em}\titlerule*[.5pc]{.}\contentspage}

  \or % book/report
    \setcounter{chapter}{0}%
    \setcounter{section}{0}%
    \gdef\@chapapp{\appendixname}%
    \titlecontents{chapter}
      [0pt]
      {\singlespacing}
      {\MakeUppercase{\appendixname~\thecontentslabel}: \MakeUppercase}
      {\MakeUppercase}
      {\hspace{.5em}\titlerule*[.5pc]{.}\contentspage}

  \fi}


% Set up title page

\renewcommand{\maketitle}{%
  \newgeometry{margin=2in}%
  \thispagestyle{empty}%
  \singlespacing
  \begin{center}
    \MakeUppercase{\@institution}

    \vfill

    \doublespacing
    \MakeUppercase{\@title}

    \vfill
    
    \singlespacing
    \MakeUppercase{Submitted to \@professor \protect\\
      in Partial Fulfilment of \protect\\\relax
    \@course}

    \vfill

    \MakeUppercase{By \protect\\\relax
      \@author \protect\\\relax
    \@date}
  \end{center}
  \restoregeometry
}

\def\author#1{\gdef\@author{#1}}
\def\@author{[Your name]}
\def\title#1{\gdef\@title{#1}}
\def\@title{Title of Paper}
\def\institution#1{\gdef\@institution{#1}}
\def\@institution{[Name of Institution]}
\def\professor#1{\gdef\@professor{#1}}
\def\@professor{[Name of Professor]}
\def\course#1{\gdef\@course{#1}}
\def\@course{[Course Number and Title]}

\endinput
